<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>
      Unique value groups with headings | Sample | ArcGIS Maps SDK for
      JavaScript 4.25
    </title>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.25/esri/themes/dark/main.css"
    />
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
    <script src="https://js.arcgis.com/4.25/"></script>

    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      #viewDiv {
        float: left;
        padding: 0;
        margin: 0;
        height: 100%;
        width: 75%;
      }
      #legend-node {
        float: left;
        width: 25%;
        height: 100%;
        padding: 1em;
        overflow: scroll;
        max-height: 100%;
        border-width: 2px;
        border-color: #323232;
        border-style: solid;
      }
    </style>

    <script>
      require([
        "esri/views/MapView",
        "esri/WebMap",
        "esri/Map",
        "esri/layers/FeatureLayer",
        "esri/widgets/Legend"
      ], (MapView, WebMap, Map, FeatureLayer, Legend) => {

    var map = new Map({
        basemap: "osm", // "streets-night-vector"
        ground: "world-elevation" // ground: "no"
  }); 

        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-123.12645, 44.06416],
          scale: 72223,
          constraints: {
            snapToZoom: false
          }
        });

        
        view.when().then(async () => {
          const osmBaseLayer = view.map.basemap.baseLayers.getItemAt(0);
          osmBaseLayer.effect = "grayscale(100%)";
        });

        function createSymbol(color) {
          return {
            type: "simple-fill",
            style: "solid",
            color,
            outline: null
          };
        }

        const renderer = {
          type: "unique-value",
          field: "zonecode",
          uniqueValueGroups: [
            {
              heading: "Commercial",
              classes: [
                {
                  label: "C-1 | Neighborhood Commercial",
                  symbol: createSymbol([189, 145, 145]),
                  values: "C-1"
                },
                {
                  label: "C-2 | Community Commercial",
                  symbol: createSymbol([255, 179, 219]),
                  values: "C-2"
                },
                {
                  label: "C-3 | Major Commercial",
                  symbol: createSymbol([255, 0, 0]),
                  values: "C-3"
                }
              ]
            },
            {
              heading: "Office",
              classes: [
                {
                  label: "GO | General Office",
                  symbol: createSymbol([176, 196, 222]),
                  values: "GO"
                },
                {
                  label: "E-1 | Campus Employment",
                  symbol: createSymbol([230, 230, 230]),
                  values: "E-1"
                },
                {
                  label: "E-2 | Mixed Use Employment",
                  symbol: createSymbol([255, 20, 255]),
                  values: "E-2"
                }
              ]
            },
            {
              heading: "Residential",
              classes: [
                {
                  label: "R-1 | Low-Density Residential",
                  symbol: createSymbol([255, 255, 224]),
                  values: "R-1"
                },
                {
                  label: "R-1.5 | Rowhouse",
                  symbol: createSymbol([255, 255, 0]),
                  values: "R-1.5"
                },
                {
                  label: "R-2 | Medium-Density Residential",
                  symbol: createSymbol([240, 230, 140]),
                  values: "R-2"
                },
                {
                  label: "R-3 | Limited High-Density Residential",
                  symbol: createSymbol([255, 214, 0]),
                  values: "R-3"
                },
                {
                  label: "R-4 | High-Density Residential",
                  symbol: createSymbol([255, 166, 0]),
                  values: "R-4"
                }
              ]
            },
            {
              heading: "Industrial",
              classes: [
                {
                  label: "I-2 | Light-Medium Industrial",
                  symbol: createSymbol([219, 112, 214]),
                  values: "I-2"
                },
                {
                  label: "I-3 | Heavy Industrial",
                  symbol: createSymbol([148, 112, 219]),
                  values: "I-3"
                }
              ]
            },
            {
              heading: "Open Space",
              classes: [
                {
                  label: "NR | Natural Resource",
                  symbol: createSymbol([125, 252, 0]),
                  values: "NR"
                },
                {
                  label: "PRO | Park, Recreation & Open Space",
                  symbol: createSymbol([0, 255, 128]),
                  values: "PRO"
                }
              ]
            },
            {
              heading: "Other",
              classes: [
                {
                  label: "AG | Agricultural",
                  symbol: createSymbol([219, 166, 33]),
                  values: "AG"
                },
                {
                  label: "PL | Public Land",
                  symbol: createSymbol([0, 191, 255]),
                  values: "PL"
                },
                {
                  label: "S | Special Area",
                  symbol: createSymbol([161, 237, 237]),
                  values: [
                    "S-DW",
                    "S-DR",
                    "S-RP",
                    "S-JW",
                    "S-RN",
                    "S-WS",
                    "S-CN",
                    "S-HB",
                    "S-F",
                    "S-W",
                    "S-E",
                    "S-C"
                  ]
                },
                {
                  label: "S-H | Historic",
                  symbol: createSymbol([0, 0, 204]),
                  values: "S-H"
                }
              ]
            }
          ]
        };

        const layer = new FeatureLayer({
          minScale: 0,
          maxScale: 0,
          portalItem: {
            id: "ebb2e1f38f274f2dbbe4cba16c6c66af"
          },
          renderer,
          blendMode: "multiply"
        });
        map.add(layer);

        // Chart

        var query = layer.createQuery();
        query.returnGeometry = true;
        query.where = "zonecode IS NOT NULL";
        query.groupByFieldsForStatistics = ["zonecode"];

        const zoneCode = [
            "AG", // [1]
            "C-1", "C-2", "C-3", //[2-4]
            "GO", // 5
            "PL", // 6
            "E-1", "E-2", // 7,8
            "I-2", "I-3", // 9,10
            "R-1", "R-2", "R-3", "R-4", // 11-14
            "NR", // 15
            "PRO", // 16
            "S-DW", "S-DR", "S-RP", "S-JW", "S-RN", "S-WS", "S-CN", "S-HB", "S-F", "S-W", "S-E", "S-C", //17-28
            "S-H" // 29
        ]       

        function originalFunction() {
            return layer.queryFeatures(query).then(function(response) {
            stats = response.features;
            const codeValues = [];
            stats.forEach((result, index) => {
                const attributes = result.attributes;
                const code = attributes.zonecode;
                const INDEX = zoneCode.indexOf(code) + 1;
                
                codeValues.push(INDEX);

            });
            
            return codeValues;
         });
        }

        function getCountEachCode(codeValues) {
            const codeValueCount = {};
            for (let i = 0; i < codeValues.length; i++) {
                codeValueCount[codeValues[i]] = 1 + (codeValueCount[codeValues[i]] || 0);
            }
            console.log(codeValueCount);

            const zc_AG = codeValueCount[1];
            const zc_C = codeValueCount[2] + codeValueCount[3] + codeValueCount[4];
            
        }

        originalFunction().then(getCountEachCode);



      

        // we need to convert {1: , 2: , 3:}. 1 = zoneCode[1]
        

        /*
        function getCountEachCode(codeValues) {
            const codeValueCount = {};
            for (let i = 0; i < codeValues.length; i++) {
                codeValueCount[codeValues[i]] = 1 + (codeValueCount[codeValues[i]] || 0);
            }
            
        }
*/
        

        new Legend({
          view,
          container: "legend-node"
        });

      });
    </script>
  </head>

  <body>
    <div id="legend-node" class="esri-widget"></div>
    <div id="viewDiv"></div>
  </body>
</html>
